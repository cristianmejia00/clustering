# Load data
load(file.path(
settings$analysis_metadata$bibliometrics_folder,
settings$analysis_metadata$project_folder,
settings$analysis_metadata$analysis_folder,
"dataset_clustering.rdata"
))
##########################################################
# Verify the data is correctly formatted for reports
source(file.path(getwd(), "04_utils", "00_verify_data.R"))
#dataset$X_E <- dataset$Z9
dataset$X_E[is.na(dataset$X_E)] <- 0
zz_env <- list('x01' = ls())
# Reporting clusters
source(file.path(getwd(), "02_citation_network", "01_execute_and_reports.R"))
View(rcs_merged)
rcs_merged$cluster_name <- rcs_merged$cluster_code
coords <- fromJSON(txt=file.path(output_folder_level, 'keyword_explorer', 'lda.json'))
coords <- data.frame('cluster' = coords$mdsDat$topics,
'x' = coords$mdsDat$x,
'y' = coords$mdsDat$y)
View(coords)
tmp <- merge(rcs_merged, coords, by='cluster')
tmp$color[grepl("KUBOTA", tmp$cluster_name)] <- "#999999",
tmp$color[grepl("CNH", tmp$cluster_name)] <- 'orange'
tmp$color
tmp$color[grepl("KUBOTA", tmp$cluster_name)] <- "#999999"
tmp$color[grepl("DEERE", tmp$cluster_name)] <- 'blue'
tmp$color[grepl("CNH", tmp$cluster_name)] <- 'orange'
tmp$color
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_column = "color",
size_column = "documents"
)
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_column = "color",
size_column = "documents"
)
tmp$color[grepl("KUBOTA", tmp$cluster_name)] <- "red"
tmp$color[grepl("DEERE", tmp$cluster_name)] <- 'blue'
tmp$color[grepl("CNH", tmp$cluster_name)] <- 'orange'
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_column = "color",
size_column = "documents"
)
library(readr)
coords <- read_csv("~/Library/CloudStorage/GoogleDrive-cristianmejia00@gmail.com/My Drive/kubota/reduced_data_kubota_2024-06-14.csv")
View(coords)
coords <- coords %>% rename(c(cluster = 'labels'))
coords <- coords %>% rename(c('cluster' = 'labels'))
View(coords)
coords <- coords %>% rename(c('cluster' = 'label'))
View(coords)
# Attach x and y
tmp <- merge(rcs_merged, coords, by='cluster')
# Add color categories
tmp$color[grepl("KUBOTA", tmp$cluster_name)] <- "red"
tmp$color[grepl("DEERE", tmp$cluster_name)] <- 'blue'
tmp$color[grepl("CNH", tmp$cluster_name)] <- 'orange'
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_column = "color",
size_column = "documents")
View(coords)
View(rcs_merged)
# Coords from notebook Bertopic
coords <- read_csv("~/Library/CloudStorage/GoogleDrive-cristianmejia00@gmail.com/My Drive/kubota/reduced_data_kubota_2024-06-14.csv")
# Attach x and y
tmp <- merge(rcs_merged,
coords,
by='cluster_code')
View(rcs_merged)
View(coords)
coords <- coords %>% rename(c('cluster_code' = 'label'))
View(coords)
# Attach x and y
tmp <- merge(rcs_merged,
coords,
by='cluster_code')
# Add color categories
tmp$color[grepl("KUBOTA", tmp$cluster_name)] <- "red"
tmp$color[grepl("DEERE", tmp$cluster_name)] <- 'blue'
tmp$color[grepl("CNH", tmp$cluster_name)] <- 'orange'
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_column = "color",
size_column = "documents")
table(dataset$SO)
table(dataset$AU)
library(readr)
dataset_initial <- read_csv("~/Library/CloudStorage/OneDrive-Personal/Documentos/03-bibliometrics/Q299/dataset.csv")
View(dataset_initial)
table(dataset_initial$AU)
dataset$SO %>% strsplit("; ") %>% unlist() %>% table() %>% sort()
firm_names[1:20]
firm_names <- dataset$SO %>% strsplit("; ") %>% unlist() %>% table() %>% sort()
firm_names[1:20]
firm_names <- dataset$SO %>% strsplit("; ") %>% unlist() %>% table() %>% sort(decreasing = TRUE)
firm_names[1:20]
dataset$text <- paste(dataste$TI, dataset$AB, sep=" ")
dataset$text <- paste(dataset$TI, dataset$AB, sep=" ")
dataset$text <- tolower(dataset)
dataset$rice <- grepl('rice', dataset$text)
table(dataset$ric)
table(dataset$rice)
table(dataset$rice, dataset$AU)
table(dataset$cluster_code[dataset$rice])
table(dataset$X_C_label[dataset$rice])
table(dataset$X_C_label[dataset$rice]) %>% sort(decreasing = TRUE)
table(dataset$X_C_label[dataset$rice]) %>% sort(decreasing = TRUE) %>% as.data.frame.AsIs()
cluster_rice <- table(dataset$X_C_label[dataset$rice]) %>% sort(decreasing = TRUE) %>% as.data.frame.AsIs()
write.csv(cluster_rice, file="cluster_rice.csv")
View(cluster_rice)
dataset$rice <- grepl(' rice', dataset$text)
table(dataset$rice)
dataset$rice <- grepl(' rice', dataset$text)
table(dataset$rice)
table(dataset$rice, dataset$AU)
cluster_rice <- table(dataset$X_C_label[dataset$rice]) %>% sort(decreasing = TRUE) %>% as.data.frame.AsIs()
write.csv(cluster_rice, file="cluster_rice.csv")
tmp2 <- tmp[tmp$cluster_code %in% rownames(cluster_rice),]
plot_scatter(tmp2, point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_column = "color",
size_column = "documents")
View(dataset)
table(dataset$Topic, dataset$AU)
write.csv(table(dataset$Topic, dataset$AU), file='topic_firms.csv')
colnames(tmp2)
# Add color categories
tmp$color[grepl("KUBOTA", tmp$cluster_name)] <- "#FF0000"
tmp$color[grepl("DEERE", tmp$cluster_name)] <- '#00FFFF'
tmp$color[grepl("CNH", tmp$cluster_name)] <- '#FFD700'
tmp$label[grepl("KUBOTA", tmp$cluster_name)] <- "KUBOTA"
tmp$label[grepl("DEERE", tmp$cluster_name)] <- 'DEERE'
tmp$label[grepl("CNH", tmp$cluster_name)] <- 'CNH'
ggplot(data = tmp,
aes(x = x,
y = y,
color = label,
size = documents)) +
geom_point() +
scale_color_manual(values = unique(df$color)) +
labs(title = "Scatter Plot",
x = "X-axis",
y = "Y-axis",
color = "Legend Title",
size = "Point Size") +
geom_text(aes(label = cluster_code), vjust = -1, hjust = 0.5, size = 3) +
theme_minimal()
View(tmp)
ggplot(data = tmp,
aes(x = x,
y = y,
color = color,
size = documents)) +
geom_point() +
scale_color_manual(values = unique(df$color)) +
labs(title = "Scatter Plot",
x = "X-axis",
y = "Y-axis",
color = "Legend Title",
size = "Point Size") +
geom_text(aes(label = cluster_code), vjust = -1, hjust = 0.5, size = 3) +
theme_minimal()
ggplot(data = tmp,
aes(x = x,
y = y,
color = color,
size = documents)) +
geom_point() +
#scale_color_manual(values = unique(df$color)) +
labs(title = "Scatter Plot",
x = "X-axis",
y = "Y-axis",
color = "Legend Title",
size = "Point Size") +
geom_text(aes(label = cluster_code), vjust = -1, hjust = 0.5, size = 3) +
theme_minimal()
tmp$color
ggplot(data = tmp,
aes(x = x,
y = y,
color = color,
size = documents)) +
geom_point() +
scale_color_manual(values = unique(df$color)) +
labs(title = "Scatter Plot",
x = "X-axis",
y = "Y-axis",
color = "Legend Title",
size = "Point Size") +
geom_text(aes(label = cluster_code), vjust = -1, hjust = 0.5, size = 3) +
theme_minimal()
ggplot(data = tmp,
aes(x = x,
y = y,
color = color,
size = documents)) +
geom_point() +
scale_color_manual(values = unique(tmp$color)) +
labs(title = "Scatter Plot",
x = "X-axis",
y = "Y-axis",
color = "Legend Title",
size = "Point Size") +
geom_text(aes(label = cluster_code), vjust = -1, hjust = 0.5, size = 3) +
theme_minimal()
ggplot(data = tmp,
aes(x = x,
y = y,
color = label,
size = documents)) +
geom_point() +
scale_color_manual(values = unique(tmp$color)) +
labs(title = "Scatter Plot",
x = "X-axis",
y = "Y-axis",
color = "Legend Title",
size = "Point Size") +
geom_text(aes(label = cluster_code), vjust = -1, hjust = 0.5, size = 3) +
theme_minimal()
plot_scatter <- function(rcs_data,
point_labels,
x_column,
y_column,
color_hex_column,
color_labels,
size_column,
x_column_label = x_column,
y_column_label = y_column) {
# format the df
df <- rcs_data[, c(point_labels, x_column, y_column, color_hex_column, color_labels, size_column)]
colnames(df) <- c("point_labels", "x", "y", "color_hex", "color_label", "size")
df$labels <- as.character(df$point_labels)
p <- ggplot(df, aes(x = x, y = y)) +
geom_point(aes(color = color_labels,
size = size)) +
scale_color_manual(values = unique(color_hex_column)) +
xlab(x_column_label) +
ylab(y_column_label)
p <- p + geom_text_repel(aes(label = gsub("---|-0", "", labels)))
p <- p + theme_bw() + theme(legend.position = "none")
p
}
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_column = "color",
color_labels = "label",
size_column = "documents")
plot_scatter <- function(rcs_data,
point_labels,
x_column,
y_column,
color_hex_column,
color_labels,
size_column,
x_column_label = x_column,
y_column_label = y_column) {
# format the df
df <- rcs_data[, c(point_labels, x_column, y_column, color_hex_column, color_labels, size_column)]
colnames(df) <- c("point_labels", "x", "y", "color_hex", "color_label", "size")
df$labels <- as.character(df$point_labels)
p <- ggplot(df, aes(x = x, y = y)) +
geom_point(aes(color = color_labels,
size = size)) +
scale_color_manual(values = unique(color_hex_column)) +
xlab(x_column_label) +
ylab(y_column_label)
p <- p + geom_text_repel(aes(label = gsub("---|-0", "", labels)))
p <- p + theme_bw() + theme(legend.position = "none")
p
}
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_hex_column = "color",
color_labels = "label",
size_column = "documents")
plot_scatter <- function(rcs_data,
point_labels,
x_column,
y_column,
color_hex_column,
color_labels,
size_column,
x_column_label = x_column,
y_column_label = y_column) {
# format the df
df <- rcs_data[, c(point_labels, x_column, y_column, color_hex_column, color_labels, size_column)]
colnames(df) <- c("point_labels", "x", "y", "color_hex", "color_label", "size")
df$labels <- as.character(df$point_labels)
p <- ggplot(df, aes(x = x, y = y)) +
geom_point(aes(colour = color_labels,
size = size)) +
scale_color_manual(values = unique(color_hex_column)) +
xlab(x_column_label) +
ylab(y_column_label)
p <- p + geom_text_repel(aes(label = gsub("---|-0", "", labels)))
p <- p + theme_bw() + theme(legend.position = "none")
p
}
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_hex_column = "color",
color_labels = "label",
size_column = "documents")
plot_scatter <- function(rcs_data,
point_labels,
x_column,
y_column,
color_hex_column,
color_labels,
size_column,
x_column_label = x_column,
y_column_label = y_column) {
# format the df
df <- rcs_data[, c(point_labels, x_column, y_column, color_hex_column, color_labels, size_column)]
colnames(df) <- c("point_labels", "x", "y", "color_hex", "color_label", "size")
df$labels <- as.character(df$point_labels)
p <- ggplot(df, aes(x = x, y = y)) +
geom_point(aes(colour = color_label,
size = size)) +
scale_color_manual(values = unique(color_hex_column)) +
xlab(x_column_label) +
ylab(y_column_label)
p <- p + geom_text_repel(aes(label = gsub("---|-0", "", labels)))
p <- p + theme_bw() + theme(legend.position = "none")
p
}
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_hex_column = "color",
color_labels = "label",
size_column = "documents")
plot_scatter <- function(rcs_data,
point_labels,
x_column,
y_column,
color_hex_column,
color_labels,
size_column,
x_column_label = x_column,
y_column_label = y_column) {
# format the df
df <- rcs_data[, c(point_labels, x_column, y_column, color_hex_column, color_labels, size_column)]
colnames(df) <- c("point_labels", "x", "y", "color_hex", "color_label", "size")
df$labels <- as.character(df$point_labels)
p <- ggplot(df, aes(x = x, y = y)) +
geom_point(aes(colour = color_label,
size = size)) +
scale_color_manual(values = unique(color_hex)) +
xlab(x_column_label) +
ylab(y_column_label)
p <- p + geom_text_repel(aes(label = gsub("---|-0", "", labels)))
p <- p + theme_bw() + theme(legend.position = "none")
p
}
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_hex_column = "color",
color_labels = "label",
size_column = "documents")
plot_scatter <- function(rcs_data,
point_labels,
x_column,
y_column,
color_hex_column,
color_labels,
size_column,
x_column_label = x_column,
y_column_label = y_column) {
# format the df
df <- rcs_data[, c(point_labels, x_column, y_column, color_hex_column, color_labels, size_column)]
colnames(df) <- c("point_labels", "x", "y", "color_hex", "color_label", "size")
df$labels <- as.character(df$point_labels)
p <- ggplot(df, aes(x = x, y = y)) +
geom_point(aes(colour = color_label,
size = size)) +
scale_color_manual(values = unique(df$color_hex)) +
xlab(x_column_label) +
ylab(y_column_label)
p <- p + geom_text_repel(aes(label = gsub("---|-0", "", labels)))
p <- p + theme_bw() + theme(legend.position = "none")
p
}
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_hex_column = "color",
color_labels = "label",
size_column = "documents")
plot_scatter <- function(rcs_data,
point_labels,
x_column,
y_column,
color_hex_column,
color_labels,
size_column,
x_column_label = x_column,
y_column_label = y_column) {
# format the df
df <- rcs_data[, c(point_labels, x_column, y_column, color_hex_column, color_labels, size_column)]
colnames(df) <- c("point_labels", "x", "y", "color_hex", "color_label", "size")
df$labels <- as.character(df$point_labels)
p <- ggplot(df, aes(x = x, y = y)) +
geom_point(aes(colour = color_label,
size = size)) +
scale_color_manual(values = unique(df$color_hex)) +
xlab(x_column_label) +
ylab(y_column_label)
p <- p + geom_text_repel(aes(label = gsub("---|-0", "", labels)))
p <- p + theme_bw() #+ theme(legend.position = "none")
p
}
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_hex_column = "color",
color_labels = "label",
size_column = "documents")
plot_scatter <- function(rcs_data,
point_labels,
x_column,
y_column,
color_hex_column,
color_labels,
size_column,
x_column_label = x_column,
y_column_label = y_column) {
# format the df
df <- rcs_data[, c(point_labels, x_column, y_column, color_hex_column, color_labels, size_column)]
colnames(df) <- c("point_labels", "x", "y", "color_hex", "color_label", "size")
df$labels <- as.character(df$point_labels)
p <- ggplot(df, aes(x = x, y = y)) +
geom_point(aes(colour = color_label,
size = size)) +
scale_color_manual(values = unique(df$color_hex)) +
xlab(x_column_label) +
ylab(y_column_label)
p <- p + geom_text_repel(aes(label = gsub("---|-0", "", labels)))
p <- p + theme_bw() + theme(legend.position = "none")
p
}
plot_scatter(tmp,
point_labels = "cluster_name",
x_column = "x",
y_column = "y",
color_hex_column = "color",
color_labels = "label",
size_column = "documents")
# - years x citations (or score)
# - years x size
# - size x citations
default_palette
View(rcs_tmp)
# assign hex colors
rcs_tmp$color_hex <- default_palette[as.integer(rcs_tmp$main_cluster)]
View(rcs_tmp)
# assign hex colors
rcs_tmp$main_cluster <- rcs_tmp$cluster
rcs_tmp$color_hex <- default_palette[as.integer(rcs_tmp$main_cluster)]
View(rcs_tmp)
rcs_tmp$color_hex[is.na(rcs_tmp$color_hex)] <- "#d3d3d3"
View(rcs_tmp)
View(rcs_tmp)
ttt <- dataset[1:50,]
ttt$WC2 <- strsplit(ttt$WC)
ttt$WC2 <- strsplit('; ', ttt$WC)
View(ttt)
?strsplit
ttt$WC2 <- strsplit(ttt$WC, '; ')
View(ttt)
ttt <- ttt %>%
select(UT, PY, WC, TI) %>%
unnest(WC)
library(tidyr)
ttt <- ttt %>%
select(UT, PY, WC, TI) %>%
unnest(WC)
View(ttt)
ttt <- dataset[1:50,]
ttt$WC2 <- strsplit(ttt$WC, '; ')
ttt <- ttt %>%
select(UT, PY, WC2, TI) %>%
unnest(WC2)
View(ttt)
